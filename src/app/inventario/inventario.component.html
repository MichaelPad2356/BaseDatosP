<h2 class="inventory-title text-center mb-4">Inventario de Productos</h2>

@if (productos.length > 0) {
  <div class="row">
    @for (producto of productos; track producto) {
      <div class="col-md-4 mb-4">
        <div class="card">
          <div class="position-relative">
            <img [src]="'../../assets/images/' + producto.URL_Imagen" alt="{{producto.Nombre}}" class="card-img-top producto-img">

            <!-- Etiquetas adicionales según el tipo de producto -->
            <!-- Ejemplo:
            <span class="badge badge-primary position-absolute top-0 end-0">Producto Especial</span>
            -->
          </div>
          <div class="card-body">
            <h5 class="card-title">{{producto.Nombre}}</h5>
            <p class="card-text">{{producto.Descripcion}}</p>
            <p class="card-text">Precio: ${{producto.Precio}}</p>
            <p class="card-text">Stock disponible: {{producto.Stock}}</p>
            <div class="d-flex justify-content-between">
              <button class="btn btn-danger btn-sm">Eliminar</button>
              <button class="btn btn-success btn-sm">Agregar</button>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
} @else {
  <p>No hay productos disponibles.</p>
}

<!-- Vista de stock por categoría -->
<h3 class="mt-5 text-center">Reporte de Stock por Categoría</h3>

@if (stockCategoria.length > 0) {
  <div class="table-responsive">
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>Categoría</th>
          <th>Total Productos</th>
          <th>Stock Total</th>
          <th>Valor Total de Stock</th>
        </tr>
      </thead>
      <tbody>
        @for (categoria of stockCategoria; track categoria) {
          <tr>
            <td>{{categoria.Nombre_Categoria}}</td>
            <td>{{categoria.Total_Productos}}</td>
            <td>{{categoria.Stock_Total}}</td>
            <td>${{categoria.Valor_Total_Stock | number: '1.2-2'}}</td>
          </tr>
        }
      </tbody>
    </table>
  </div>
} @else {
  <p>No se pudo obtener el reporte de stock por categoría.</p>
}


<h2 class="mt-5 mb-4 text-center text-danger">Productos Más Vendidos (1-15 de diciembre)</h2>

<div class="table-responsive">
  <table class="table table-striped table-bordered text-center align-middle">
    <thead class="table-dark">
      <tr>
        <th scope="col">Imagen</th>
        <th scope="col">Nombre</th>
        <th scope="col">Descripción</th>
        <th scope="col">Precio</th>
        <th scope="col">Cantidad Vendida</th>
        <th scope="col">Categoría</th>
      </tr>
    </thead>
    <tbody>
      @for (producto of productosMasVendidos; track producto) {
        <tr>
          <!-- Imagen del producto -->
          <td class="img">
            <img [src]="'../../assets/images/' + producto.URL_Imagen" alt="{{producto.Nombre}}" class="img">
          </td>

          <!-- Nombre del producto -->
          <td class="fw-bold">{{ producto.Nombre }}</td>

          <!-- Descripción del producto -->
          <td class="text-start">{{ producto.Descripcion }}</td>

          <!-- Precio del producto -->
          <td class="text-success fw-bold">${{ producto.Precio | number: '1.2-2' }}</td>

          <!-- Cantidad Vendida (corrección aquí) -->
          <td>{{ producto.Total_Vendido }}</td>

          <!-- Categoría del producto -->
          <td>{{ producto.Nombre_Categoria }}</td>
        </tr>
      }
    </tbody>
  </table>
</div>

<h3 class="mt-5 mb-4 text-center text-primary">Categorías con Ventas Mayores a $5000</h3>

<div class="table-responsive">
  <table class="table table-striped table-bordered text-center">
    <thead class="table-dark">
      <tr>
        <th scope="col">ID Categoría</th>
        <th scope="col">Total Ventas</th>
      </tr>
    </thead>
    <tbody>
      @for (categoria of categoriasMasVendidas; track categoria) {
        <tr>
          <td>{{ categoria.ID_Categoria }}</td>
          <td class="text-success fw-bold">${{ categoria.Total_Ventas | number: '1.2-2' }}</td>
        </tr>
      }
    </tbody>
  </table>
</div>

<!-- Botón para abrir la ventana modal de Pedidos -->
<div class="text-center mb-4">
  <button class="btn btn-primary" (click)="abrirModal()">Ver Pedidos</button>
</div>

<!-- Ventana modal para mostrar los pedidos -->
<div class="modal" tabindex="-1" [class.show]="mostrarModal" [style.display]="mostrarModal ? 'block' : 'none'">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Pedidos Completos</h5>
        <button type="button" class="btn-close" (click)="cerrarModal()"></button>
      </div>
      <div class="modal-body">
        @if (pedidos.length > 0) {
          <div>
            <table class="table table-bordered table-striped">
              <thead>
                <tr>
                  <th>Nombre Usuario</th>
                  <th>Correo</th>
                  <th>Producto</th>
                  <th>Descripción</th>
                  <th>Precio</th>
                  <th>Cantidad</th>
                  <th>Monto Total</th>
                  <th>Fecha Pedido</th>
                  <th>Estado Pedido</th>
                  <th>Método de Pago</th>
                  <th>Dirección Envío</th>
                  <th>Estado Envío</th>
                </tr>
              </thead>
              <tbody>
                @for (pedido of pedidos; track pedido) {
                  <tr>
                    <td>{{ pedido.Nombre_Usuario }}</td>
                    <td>{{ pedido.Correo_Usuario }}</td>
                    <td>{{ pedido.Producto_Nombre }}</td>
                    <td>{{ pedido.Producto_Descripcion }}</td>
                    <td>${{ pedido.Producto_Precio }}</td>
                    <td>{{ pedido.Cantidad }}</td>
                    <td>${{ pedido.Pago_Monto }}</td>
                    <td>{{ pedido.Fecha_Pedido }}</td>
                    <td>{{ pedido.Estado_Pedido }}</td>
                    <td>{{ pedido.Metodo_Pago }}</td>
                    <td>{{ pedido.Direccion_Envio }}</td>
                    <td>{{ pedido.Estado_Envio }}</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        } @else {
          <p>No hay pedidos disponibles.</p>
        }
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cerrarModal()">Cerrar</button>
      </div>
    </div>
  </div>
</div>
